syntax = "proto3";

package tienlen.v1;

option go_package = "tienlen/proto;pb";

// --- Enums ---

enum Suit {
  SUIT_SPADES = 0;
  SUIT_CLUBS = 1;
  SUIT_DIAMONDS = 2;
  SUIT_HEARTS = 3;
}

enum Rank {
  RANK_THREE = 0;
  RANK_FOUR = 1;
  RANK_FIVE = 2;
  RANK_SIX = 3;
  RANK_SEVEN = 4;
  RANK_EIGHT = 5;
  RANK_NINE = 6;
  RANK_TEN = 7;
  RANK_JACK = 8;
  RANK_QUEEN = 9;
  RANK_KING = 10;
  RANK_ACE = 11;
  RANK_TWO = 12;
}

enum GamePhase {
  PHASE_WAITING = 0;
  PHASE_PLAYING = 1;
  PHASE_FINISHED = 2;
}

enum OpCode {
  OP_CODE_UNSPECIFIED = 0;
  OP_CODE_START_GAME = 1;
  OP_CODE_PLAY_CARDS = 2;
  OP_CODE_PASS_TURN = 3;
  OP_CODE_REQUEST_NEW_GAME = 4;

  OP_CODE_PLAYER_JOINED = 50;
  OP_CODE_PLAYER_LEFT = 51;

  OP_CODE_GAME_STARTED = 100;
  OP_CODE_CARD_PLAYED = 102;
  OP_CODE_TURN_PASSED = 103;
  OP_CODE_GAME_ENDED = 104;
  OP_CODE_GAME_ERROR = 105;
}

// --- Basic Structures ---

message Card {
  Suit suit = 1;
  Rank rank = 2;
}

message PlayerState {
    string user_id = 1;
    int32 seat = 2;
    bool is_owner = 3;
    int32 cards_remaining = 4; // Public info
    string display_name = 5;
    int32 avatar_index = 6;
}

// --- Client -> Server Requests ---

message StartGameRequest {}

message PlayCardsRequest {
  repeated Card cards = 1;
}

message PassTurnRequest {}

message RequestNewGameRequest {}

// --- Server -> Client Events ---

message PlayerJoinedEvent {
  PlayerState player = 1;
}

message PlayerLeftEvent {
  string user_id = 1;
}

// Snapshot of lobby state broadcast after a player joins.
message MatchStateSnapshot {
  repeated string seats = 1;
  string owner_id = 2;
  int64 tick = 3;
  repeated PlayerState players = 4; // Full player details
}

message GameStartedEvent {
  string first_turn_user_id = 1;
  GamePhase phase = 2;
  repeated Card hand = 3;
}

message CardPlayedEvent {
  string user_id = 1;
  repeated Card cards = 2;
  string next_turn_user_id = 3; // Inform everyone who goes next immediately
  bool new_round = 4; // True if this clears the board
}

message TurnPassedEvent {
  string user_id = 1;
  string next_turn_user_id = 2;
  bool new_round = 3; // True if this pass results in a round reset
}

message GameEndedEvent {
  repeated string finish_order = 1; // UserIDs in rank order (1st, 2nd, 3rd...)
}

message GameErrorEvent {
    int32 code = 1;
    string message = 2;
}
